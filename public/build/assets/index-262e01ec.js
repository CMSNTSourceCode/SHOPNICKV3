import{r as v,c as z,o as le,a as u,b as d,d as o,w as i,m as h,h as l,g as t,j as _,u as H,F as g,e as q,f as m,t as c,i as ie,l as de,A as re}from"./chunk-6b34d741.js";import{u as ce}from"./chunk-8dacd294.js";import{a as k,h as B}from"./chunk-12ee37c2.js";import"./chunk-e47d8634.js";const ue=t("i",{class:"fas fa-plus me-2"},null,-1),_e={class:"overflow-auto"},pe={class:"mb-5 flex flex-col gap-5 md:flex-row md:items-center"},me={class:"ltr:ml-auto rtl:mr-auto flex gap-x-2"},ve=t("i",{class:"fas fa-credit-card me-2"},null,-1),he={key:1,class:"text-green-700"},fe={key:0,class:"font-bold text-warning-600"},ge={key:1,class:"font-bold text-green-700"},ye={key:2,class:"font-bold text-red-700"},xe={key:3,class:"font-bold text-gray-700"},be={key:0,class:"text-red-700"},ke={key:1,class:"text-primary-600"},Ce={class:"text-center text-3xl"},we={class:"text-red-600"},Te={key:0,class:"grid grid-cols-1 md:grid-cols-2"},Ne={class:"p-6 text-lg md:flex md:items-center"},Ie={class:"w-full"},He={class:"flex justify-between"},Se=t("div",null,"Mã Hoá Đơn:",-1),$e={class:"text-red-600"},je=["data-clipboard-text"],Me=t("i",{class:"fas fa-copy"},null,-1),Ve=[Me],De={class:"flex justify-between"},ze=t("div",null,"Ngân Hàng:",-1),qe={class:"text-green-600"},Be={class:"flex justify-between"},Pe=t("div",null,"Số Tài Khoản:",-1),Ke={class:"text-red-600"},Le=["data-clipboard-text"],Ue=t("i",{class:"fas fa-copy"},null,-1),Fe=[Ue],Ye={class:"flex justify-between"},Ae=t("div",null,"Chủ Tài Khoản:",-1),Qe={class:"text-green-600"},Re={class:"flex justify-between"},Ee=t("div",null,"Số Tiền Chuyển:",-1),Ge={class:"text-red-600"},Oe=["data-clipboard-text"],Xe=t("i",{class:"fas fa-copy"},null,-1),Je=[Xe],We={class:"text-center"},Ze=["src"],et={__name:"Index",setup(tt){const C=v(""),P=[{title:"ID",dataIndex:"id",sorter:!0},{title:"Thao Tác",dataIndex:"action"},{title:"Hoá Đơn",dataIndex:"code"},{title:"Số Tiền",dataIndex:"amount"},{title:"Tài Khoản",dataIndex:"username"},{title:"Còn Lại",dataIndex:"expired_str"},{title:"Trạng Thái",dataIndex:"status"},{title:"Thời Gian",dataIndex:"created_at",sorter:!0},{title:"Cập Nhật",dataIndex:"updated_at",sorter:!0}],K=a=>k.get("/api/users/invoices",{params:{search:C.value,...a}}),{data:L,current:U,totalPage:F,loading:$,pageSize:Y,run:A,refresh:w}=ce(K,{formatResult:a=>{const{data:e,meta:n}=a.data.data;return{data:e??[],totalPage:n.total_rows??0}},defaultParams:[{sort_by:"id",sort_type:"desc",limit:10}],pagination:{currentKey:"page",pageSizeKey:"limit"}}),j=(a,e=null)=>{if(a===null)return"";const n=B(a,B.ISO_8601);return n.isValid()?e?n.format(e):n.format("HH:mm:ss - DD/MM/YYYY"):""},Q=z(()=>{var a;return((a=L.value)==null?void 0:a.data)??[]}),R=z(()=>({page:U.value,total:F.value,limit:Y.value})),E=(a,e,n)=>{A({page:a==null?void 0:a.current,limit:a.pageSize,sort_by:n.field,sort_type:n.order==="ascend"?"asc":"desc",...e})},y=v(!1),G=()=>{y.value=!0},T=a=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(a),M=v([]),O=async()=>{var a;try{const{data:e}=await k.get("/api/users/banks");M.value=(a=e.data)==null?void 0:a.map(n=>({...n,label:`${n.name} - ${n.owner} - ${n.number}`,value:n.id}))}catch(e){h.error($catchMessage(e))}},f=v({amount:1e4,bank_id:null}),N=v(!1),X=async a=>{if(!a.bank_id){h.error("Vui Lòng Chọn Ngân Hàng Để Nạp");return}N.value=!0;try{const{data:e}=await k.post("/api/users/invoices",a);h.success(e.message),y.value=!1,w()}catch(e){h.error($catchMessage(e))}finally{N.value=!1}},x=v(!1),r=v(null),V=async a=>{if(a.id){x.value=!1,h.loading("Đang Tải Thông Tin Hoá Đơn...",0);try{const{data:e}=await k.get("/api/users/invoices/"+a.id),n=e.data;if(n.status!=="processing")return Swal.fire("Thành Công","Hoá Đơn Đã Được Cập Nhật Rồi","success"),w();r.value={id:n.id,code:n.code,bank:n.payment_details,status:n.status,amount:n.amount},x.value=!0}catch(e){h.error($catchMessage(e))}finally{h.destroy()}}},J=a=>{const{bank:e}=a;return`https://api.vietqr.io/${e.name}/${e.number}/${a.amount}/${a.code}/vietqr_net_2.jpg?accountName=${e.owner}`};return le(()=>{O()}),(a,e)=>{const n=u("a-button"),W=u("a-input"),Z=u("a-table"),ee=u("a-card"),te=u("a-input-number"),b=u("a-form-item"),ae=u("a-select-option"),ne=u("a-select"),se=u("a-form"),D=u("a-modal"),oe=u("a-alert");return l(),d("div",null,[o(ee,{title:"Danh Sách Hoá Đơn"},{default:i(()=>[t("div",null,[o(n,{type:"primary",onClick:G},{default:i(()=>[ue,_(" Tạo Hoá Đơn Mới")]),_:1})]),t("div",_e,[t("div",pe,[t("div",me,[o(W,{value:C.value,"onUpdate:value":e[0]||(e[0]=s=>C.value=s),placeholder:"Tìm kiếm"},null,8,["value"]),o(n,{type:"primary",loading:H($),onClick:H(w)},{default:i(()=>[_(" Tìm kiếm ")]),_:1},8,["loading","onClick"])])]),o(Z,{dataSource:Q.value,columns:P,loading:H($),pagination:R.value,size:"small",onChange:E,class:"font-medium whitespace-nowrap"},{bodyCell:i(({column:s,text:p,record:I})=>[s.dataIndex==="action"?(l(),d(g,{key:0},[I.status==="processing"?(l(),q(n,{key:0,size:"small",onClick:at=>V(I)},{default:i(()=>[ve,_(" Thanh Toán")]),_:2},1032,["onClick"])):m("",!0)],64)):m("",!0),s.dataIndex==="amount"?(l(),d("strong",he,c(T(p)),1)):m("",!0),s.dataIndex==="status"?(l(),d(g,{key:2},[p==="processing"?(l(),d("span",fe,"Đang Chờ")):p==="completed"?(l(),d("span",ge,"Hoàn Thành")):p==="cancelled"?(l(),d("span",ye,"Bị Huỷ/Xoá")):(l(),d("span",xe,c(p),1))],64)):m("",!0),s.dataIndex==="expired_str"?(l(),d(g,{key:3},[I.is_expired?(l(),d("strong",be,"-")):(l(),d("strong",ke,c(p),1))],64)):m("",!0),s.dataIndex==="created_at"?(l(),d(g,{key:4},[_(c(j(p)),1)],64)):m("",!0),s.dataIndex==="updated_at"?(l(),d(g,{key:5},[_(c(j(p)),1)],64)):m("",!0)]),_:1},8,["dataSource","loading","pagination"])])]),_:1}),o(D,{open:y.value,"onUpdate:open":e[3]||(e[3]=s=>y.value=s),footer:null},{default:i(()=>[o(se,{model:f.value,layout:"vertical",onFinish:X},{default:i(()=>[o(b,{label:"Số Tiền Nạp",name:"amount",rules:[{required:!0,message:"Vui Lòng Nhập Số Tiền Cần Nạp"}]},{default:i(()=>[o(te,{value:f.value.amount,"onUpdate:value":e[1]||(e[1]=s=>f.value.amount=s),min:1e4,max:1e9,style:{width:"100%"},size:"large"},null,8,["value"])]),_:1}),o(b,{label:"Chọn Ngân Hàng",name:"bank_id",rules:[{required:!0,message:"Vui Lòng Chọn Ngân Hàng Để Nạp"}]},{default:i(()=>[o(ne,{value:f.value.bank_id,"onUpdate:value":e[2]||(e[2]=s=>f.value.bank_id=s),placeholder:"Chọn Ngân Hàng"},{default:i(()=>[(l(!0),d(g,null,ie(M.value,s=>(l(),q(ae,{key:s.value,value:s.value,size:"large"},{default:i(()=>[_(c(s.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),o(b,null,{default:i(()=>[t("div",Ce,[t("strong",we,c(T(f.value.amount)),1)])]),_:1}),o(b,null,{default:i(()=>[o(n,{type:"primary",htmlType:"submit",block:"",loading:N.value},{default:i(()=>[_("Tạo Ngay")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]),o(D,{width:"900px",open:x.value,"onUpdate:open":e[5]||(e[5]=s=>x.value=s),footer:null},{default:i(()=>[o(oe,{type:"error",message:"Quý khách vui lòng chuyển khoản với nội dung là mã Hoá đơn đến số tài khoản bên dưới hoặc quét Mã QR dưới đây để nạp tiền.",class:"mt-5 mb-4"}),r.value?(l(),d("div",Te,[t("div",Ne,[t("div",Ie,[t("div",He,[Se,t("div",$e,[_(c(r.value.code)+" ",1),t("a",{href:"javascript:void(0)",class:"copy","data-clipboard-text":r.value.code},Ve,8,je)])]),t("div",De,[ze,t("div",qe,c(r.value.bank.name),1)]),t("div",Be,[Pe,t("div",Ke,[_(c(r.value.bank.number)+" ",1),t("a",{href:"javascript:void(0)",class:"copy","data-clipboard-text":r.value.bank.number},Fe,8,Le)])]),t("div",Ye,[Ae,t("div",Qe,c(r.value.bank.owner),1)]),t("div",Re,[Ee,t("div",Ge,[_(c(T(r.value.amount))+" ",1),t("a",{href:"javascript:void(0)",class:"copy","data-clipboard-text":r.value.amount},Je,8,Oe)])]),t("div",We,[o(n,{onClick:e[4]||(e[4]=s=>V({id:r.value.id}))},{default:i(()=>[_("Cập Nhật")]),_:1})])])]),t("div",null,[t("img",{src:J(r.value)},null,8,Ze)])])):m("",!0)]),_:1},8,["open"])])}}},S=de({});S.use(re);S.component("deposit-index",et);S.mount("#app");
